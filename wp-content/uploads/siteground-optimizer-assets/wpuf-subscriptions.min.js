(function(a){var b={init:function(){a('input#wpuf-recuring-pay').on('click',this.showSubscriptionRecurring),a('input#wpuf-trial-status').on('click',this.showSubscriptionPack),a('.wpuf-coupon-info-wrap').on('click','a.wpuf-apply-coupon',this.couponApply),a('.wpuf-coupon-info-wrap').on('click','a.wpuf-copon-show',this.couponShow),a('.wpuf-coupon-info-wrap').on('click','a.wpuf-copon-cancel',this.couponCancel),a('.wpuf-assing-pack-btn').on('click',this.showPackDropdown),a('.wpuf-delete-pack-btn').on('click',this.deletePack),a('.wpuf-disabled-link').click(this.packAlert),this.changeExpirationFieldVisibility(':checkbox#wpuf-enable_post_expiration'),a('.wpuf-metabox-post_expiration').on('change',':checkbox#wpuf-enable_post_expiration',this.changeExpirationFieldVisibility),a('.wpuf-metabox-post_expiration').on('change','select#wpuf-expiration_time_type',this.setTimeExpiration)},packAlert:function(){alert(wpuf_subscription.pack_notice)},showPackDropdown:function(h){h.preventDefault();var g=a(this),b=g.parents('.wpuf-user-subscription'),c=b.find('.wpuf-pack-dropdown'),e=b.find('.wpuf-user-sub-info'),f=b.find('.wpuf-cancel-pack'),d=b.find('.wpuf-add-pack');c.attr('disabled')==='disabled'?(c.show().removeAttr('disabled'),e.hide().attr('disabled',!0),f.show(),d.hide()):(e.show().removeAttr('disabled'),c.hide().attr('disabled',!0),f.hide(),d.show())},deletePack:function(c){var d=a(this),b=d.parents('.wpuf-user-subscription'),e=b.find('.wpuf-pack-dropdown'),f=b.find('#wpuf_sub_pack'),g=a(c.target).attr('data-userid'),h=a(c.target).attr('data-packid');b.find('.wpuf-delete-pack-btn').attr('disabled',!0),b.css('opacity',.5),a.post(ajaxurl,{action:'wpuf_delete_user_package',userid:g,packid:h,wpuf_subscription_delete_nonce:wpuf_subs_vars.wpuf_subscription_delete_nonce},function(d){d&&(b.css('opacity',1),a('.wpuf-user-sub-info').remove(),a(c.target).remove(),f.val(-1),e.show())})},couponCancel:function(d){d.preventDefault();var b=a(this),e={action:'coupon_cancel',_wpnonce:wpuf_frontend.nonce,pack_id:b.data('pack_id')},c=b.parents('.wpuf-coupon-info-wrap').find('input.wpuf-coupon-field');c.addClass('wpuf-coupon-field-spinner'),a.post(wpuf_frontend.ajaxurl,e,function(d){if(c.removeClass('wpuf-coupon-field-spinner'),d.success){a('.wpuf-pack-inner').html(d.data.append_data),a('.wpuf-coupon-id-field').val('');var e=b.closest('.wpuf-copon-wrap');e.hide(),e.siblings('.wpuf-copon-show').show(),a('.wpuf-subscription-success').html(''),a('.wpuf-subscription-error').html('')}})},couponShow:function(c){c.preventDefault();var b=a(this);b.hide(),b.parents('.wpuf-coupon-info-wrap').find('.wpuf-copon-wrap').show()},couponApply:function(f){var b,c,d,e;if(f.preventDefault(),b=a(this),c=b.parents('.wpuf-coupon-info-wrap').find('input.wpuf-coupon-field'),d=c.val(),d===''){a('.wpuf-subscription-error').html(wpuf_frontend.coupon_error);return}e={action:'coupon_apply',_wpnonce:wpuf_frontend.nonce,coupon:d,pack_id:b.data('pack_id')},b.attr('disabled')==='disabled',b.attr('disabled',!0),c.addClass('wpuf-coupon-field-spinner'),a.post(wpuf_frontend.ajaxurl,e,function(b){c.removeClass('wpuf-coupon-field-spinner'),b.success?(a('.wpuf-pack-inner').html(b.data.append_data),a('.wpuf-coupon-id-field').val(b.data.coupon_id),b.data.amount<=0&&a('.wpuf-nullamount-hide').hide(),a('.wpuf-subscription-success').html(b.data.message),a('.wpuf-subscription-error').html('')):(a('.wpuf-subscription-success').html(''),a('.wpuf-subscription-error').html(b.data.message))})},showSubscriptionRecurring:function(){var c=a(this),b=c.parents('table.form-table'),d=b.find('.wpuf-recurring-child'),g=b.find('input#wpuf-trial-status'),e=b.find('.wpuf-trial-child'),f=b.find('.wpuf-subcription-expire');c.is(':checked')?(g.is(':checked')&&e.show(),d.show(),f.hide()):(e.hide(),d.hide(),f.show())},showSubscriptionPack:function(){var b=a(this),c=b.closest('table.form-table').find('.wpuf-trial-child');b.is(':checked')?c.show():c.hide()},setTimeExpiration:function(b){var d={day:30,month:12,year:100},e,c;a('#wpuf-expiration_time_value').html(''),e=b.target?a(b.target).val():a(b).val();for(c=1;c<=d[e];c++)a('#wpuf-expiration_time_value').append('<option>'+c+'</option>')},changeExpirationFieldVisibility:function(b){var c=b.target?a(b.target):a(b);c.is(':checked')?a('.wpuf_subscription_expiration_field').show():a('.wpuf_subscription_expiration_field').hide()}};typeof datepicker=='function'&&a('.wpuf-date-picker').datepicker({dateFormat:"yy-mm-dd"}),b.init()})(jQuery)